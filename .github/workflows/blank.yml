name: CI / CD with Parallel Dev & Prod Approvals

on:
  push:
    branches:
      - master

jobs:
  # 1) Build
  build:
    name: üõ† Build & Package
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Build artifact
        run: |
          echo "üî® Building..."
          # e.g. docker build -t myapp:${{ github.run_id }} .
          # or make build

      - name: Upload build artifact
        uses: actions/upload-artifact@v4       # v4 replaces the deprecated v3
        with:
          name: build-output
          path: path/to/build

  # 2a) Wait for Dev approval
  wait-dev:
    name: ‚úÖ Wait for Dev Approval
    needs: build
    runs-on: ubuntu-latest
    steps:
      - name: Request Dev approval
        uses: trstringer/manual-workflow-approval@v1.11.0
        with:
          approvers: |
            @your-username            # GitHub handle(s) who can approve
          issue-title: "Approve ‚ñ∂Ô∏è Dev Deployment"
          approve-comment: "approved"
          deny-comment: "denied"

  # 2b) Wait for Prod approval
  wait-prod:
    name: ‚úÖ Wait for Prod Approval
    needs: build
    runs-on: ubuntu-latest
    steps:
      - name: Request Prod approval
        uses: trstringer/manual-workflow-approval@v1
